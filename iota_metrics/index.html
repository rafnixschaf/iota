<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `iota_metrics` crate."><title>iota_metrics - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="iota_metrics" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../iota_metrics/index.html">iota_metrics</a><span class="version">0.7.0-alpha</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Aliases</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">iota_metrics</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/iota_metrics/lib.rs.html#5-731">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.scopeguard"><code>pub use <a class="mod" href="https://docs.rs/scopeguard/1/scopeguard/index.html" title="mod scopeguard">scopeguard</a>;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="histogram/index.html" title="mod iota_metrics::histogram">histogram</a></div></li><li><div class="item-name"><a class="mod" href="metered_channel/index.html" title="mod iota_metrics::metered_channel">metered_channel</a></div></li><li><div class="item-name"><a class="mod" href="metrics_network/index.html" title="mod iota_metrics::metrics_network">metrics_network</a></div></li><li><div class="item-name"><a class="mod" href="monitored_mpsc/index.html" title="mod iota_metrics::monitored_mpsc">monitored_mpsc</a></div><div class="desc docblock-short">Provides wrappers to tokio mpsc channels, with metrics on total items sent,
received and inflight.</div></li><li><div class="item-name"><a class="mod" href="thread_stall_monitor/index.html" title="mod iota_metrics::thread_stall_monitor">thread_stall_monitor</a></div></li></ul><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.forward_server_timing_and_spawn.html" title="macro iota_metrics::forward_server_timing_and_spawn">forward_server_timing_and_spawn</a></div></li><li><div class="item-name"><a class="macro" href="macro.monitored_future.html" title="macro iota_metrics::monitored_future">monitored_future</a></div></li><li><div class="item-name"><a class="macro" href="macro.spawn_logged_monitored_task.html" title="macro iota_metrics::spawn_logged_monitored_task">spawn_logged_monitored_task</a></div></li><li><div class="item-name"><a class="macro" href="macro.spawn_monitored_task.html" title="macro iota_metrics::spawn_monitored_task">spawn_monitored_task</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CancelMonitor.html" title="struct iota_metrics::CancelMonitor">CancelMonitor</a></div><div class="desc docblock-short">A future that runs within a monitored scope. This struct wraps a pinned
future and holds an optional <code>MonitoredScopeGuard</code> to measure and monitor
the execution of the future. It forwards polling operations
to the underlying future while maintaining the monitoring scope.</div></li><li><div class="item-name"><a class="struct" href="struct.GaugeGuard.html" title="struct iota_metrics::GaugeGuard">GaugeGuard</a></div><div class="desc docblock-short">Increments gauge when acquired, decrements when guard drops</div></li><li><div class="item-name"><a class="struct" href="struct.GaugeGuardFuture.html" title="struct iota_metrics::GaugeGuardFuture">GaugeGuardFuture</a></div><div class="desc docblock-short">A struct that wraps a future (<code>f</code>) with a <code>GaugeGuard</code>. The
<code>GaugeGuardFuture</code> is used to manage the lifecycle of a future while
ensuring the associated <code>GaugeGuard</code> properly tracks the resource usage
during the future’s execution. The guard increments the gauge
when the future starts and decrements it when the <code>GaugeGuardFuture</code> is
dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.Metrics.html" title="struct iota_metrics::Metrics">Metrics</a></div></li><li><div class="item-name"><a class="struct" href="struct.MonitoredScopeFuture.html" title="struct iota_metrics::MonitoredScopeFuture">MonitoredScopeFuture</a></div><div class="desc docblock-short">A future that runs within a monitored scope. This struct wraps a pinned
future and holds an optional <code>MonitoredScopeGuard</code> to measure and monitor
the execution of the future. It forwards polling operations
to the underlying future while maintaining the monitoring scope.</div></li><li><div class="item-name"><a class="struct" href="struct.MonitoredScopeGuard.html" title="struct iota_metrics::MonitoredScopeGuard">MonitoredScopeGuard</a></div></li><li><div class="item-name"><a class="struct" href="struct.RegistryService.html" title="struct iota_metrics::RegistryService">RegistryService</a></div><div class="desc docblock-short">A service to manage the prometheus registries. This service allow us to
create a new Registry on demand and keep it accessible for
processing/polling. The service can be freely cloned/shared across threads.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.LATENCY_SEC_BUCKETS.html" title="constant iota_metrics::LATENCY_SEC_BUCKETS">LATENCY_SEC_BUCKETS</a></div></li><li><div class="item-name"><a class="constant" href="constant.METRICS_ROUTE.html" title="constant iota_metrics::METRICS_ROUTE">METRICS_ROUTE</a></div></li><li><div class="item-name"><a class="constant" href="constant.TX_TYPE_SHARED_OBJ_TX.html" title="constant iota_metrics::TX_TYPE_SHARED_OBJ_TX">TX_TYPE_SHARED_OBJ_TX</a></div></li><li><div class="item-name"><a class="constant" href="constant.TX_TYPE_SINGLE_WRITER_TX.html" title="constant iota_metrics::TX_TYPE_SINGLE_WRITER_TX">TX_TYPE_SINGLE_WRITER_TX</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.GaugeGuardFutureExt.html" title="trait iota_metrics::GaugeGuardFutureExt">GaugeGuardFutureExt</a></div></li><li><div class="item-name"><a class="trait" href="trait.MonitorCancellation.html" title="trait iota_metrics::MonitorCancellation">MonitorCancellation</a></div><div class="desc docblock-short">MonitorCancellation records a cancelled = true span attribute if the future
it is decorating is dropped before completion. The cancelled attribute must
be added at span creation, as you cannot add new attributes after the span
is created.</div></li><li><div class="item-name"><a class="trait" href="trait.MonitoredFutureExt.html" title="trait iota_metrics::MonitoredFutureExt">MonitoredFutureExt</a></div><div class="desc docblock-short">A trait extension for <code>Future</code> to allow monitoring the execution of the
future within a specific scope. Provides the <code>in_monitored_scope</code> method to
wrap the future in a <code>MonitoredScopeFuture</code>, which tracks the future’s
execution using a <code>MonitoredScopeGuard</code> for monitoring purposes.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_server_timing.html" title="fn iota_metrics::add_server_timing">add_server_timing</a></div><div class="desc docblock-short">Add a new entry to the ServerTiming header.
If the caller is not currently in a ServerTiming context (created with
<code>with_new_server_timing</code>), an error is logged.</div></li><li><div class="item-name"><a class="fn" href="fn.get_metrics.html" title="fn iota_metrics::get_metrics">get_metrics</a></div><div class="desc docblock-short">Retrieves the global <code>METRICS</code> instance if it has been initialized.</div></li><li><div class="item-name"><a class="fn" href="fn.get_server_timing.html" title="fn iota_metrics::get_server_timing">get_server_timing</a></div><div class="desc docblock-short">Get the currently active ServerTiming context. Only intended for use by
macros within this module.</div></li><li><div class="item-name"><a class="fn" href="fn.init_metrics.html" title="fn iota_metrics::init_metrics">init_metrics</a></div><div class="desc docblock-short">Initializes the global <code>METRICS</code> instance by setting it to a new <code>Metrics</code>
object registered with the provided <code>Registry</code>. If <code>METRICS</code> is already set,
a warning is logged indicating that the metrics registry was overwritten.
This function is intended to be called once during initialization to set up
metrics collection.</div></li><li><div class="item-name"><a class="fn" href="fn.metrics.html" title="fn iota_metrics::metrics">metrics</a></div><div class="desc docblock-short">Handles a request to retrieve metrics, using the provided <code>RegistryService</code>
to gather all registered metric families. The metrics are then encoded to a
text format for easy consumption by monitoring systems. If successful, it
returns the metrics string with an <code>OK</code> status. If an error occurs during
encoding, it returns an <code>INTERNAL_SERVER_ERROR</code> status along with an error
message. Returns a tuple containing the status code and either the metrics
data or an error description.</div></li><li><div class="item-name"><a class="fn" href="fn.monitored_scope.html" title="fn iota_metrics::monitored_scope">monitored_scope</a></div><div class="desc docblock-short">This function creates a named scoped object, that keeps track of</div></li><li><div class="item-name"><a class="fn" href="fn.server_timing_middleware.html" title="fn iota_metrics::server_timing_middleware">server_timing_middleware</a></div></li><li><div class="item-name"><a class="fn" href="fn.start_prometheus_server.html" title="fn iota_metrics::start_prometheus_server">start_prometheus_server</a></div></li><li><div class="item-name"><a class="fn" href="fn.uptime_metric.html" title="fn iota_metrics::uptime_metric">uptime_metric</a></div><div class="desc docblock-short">Create a metric that measures the uptime from when this metric was
constructed. The metric is labeled with:</div></li><li><div class="item-name"><a class="fn" href="fn.with_new_server_timing.html" title="fn iota_metrics::with_new_server_timing">with_new_server_timing</a></div><div class="desc docblock-short">Create a new task-local ServerTiming context and run the provided future
within it. Should be used at the top-most level of a request handler. Can be
added to an axum router as a layer by using
iota_service::server_timing_middleware.</div></li><li><div class="item-name"><a class="fn" href="fn.with_server_timing.html" title="fn iota_metrics::with_server_timing">with_server_timing</a></div><div class="desc docblock-short">Create a new task-local ServerTiming context and run the provided future
within it. Only intended for use by macros within this module.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.RegistryID.html" title="type iota_metrics::RegistryID">RegistryID</a></div></li></ul></section></div></main></body></html>