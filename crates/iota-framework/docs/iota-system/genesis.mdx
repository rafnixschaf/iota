---
title: Module `0x3::genesis`
---
import Link from '@docusaurus/Link';

<Link id="0x3_genesis"/>


-  [Struct `GenesisValidatorMetadata`](#0x3_genesis_GenesisValidatorMetadata)
-  [Struct `GenesisChainParameters`](#0x3_genesis_GenesisChainParameters)
-  [Struct `TokenDistributionSchedule`](#0x3_genesis_TokenDistributionSchedule)
-  [Struct `TokenAllocation`](#0x3_genesis_TokenAllocation)
-  [Constants](#@Constants_0)
-  [Function `create`](#0x3_genesis_create)
-  [Function `allocate_tokens`](#0x3_genesis_allocate_tokens)
-  [Function `activate_validators`](#0x3_genesis_activate_validators)


<pre><code>
<b>use</b> <Link to="../move-stdlib/option#0x1_option">0x1::option</Link>;
<b>use</b> <Link to="../move-stdlib/string#0x1_string">0x1::string</Link>;
<b>use</b> <Link to="../move-stdlib/vector#0x1_vector">0x1::vector</Link>;
<b>use</b> <Link to="../iota-framework/balance#0x2_balance">0x2::balance</Link>;
<b>use</b> <Link to="../iota-framework/coin#0x2_coin">0x2::coin</Link>;
<b>use</b> <Link to="../iota-framework/iota#0x2_iota">0x2::iota</Link>;
<b>use</b> <Link to="../iota-framework/object#0x2_object">0x2::object</Link>;
<b>use</b> <Link to="../iota-framework/timelock#0x2_timelock">0x2::timelock</Link>;
<b>use</b> <Link to="../iota-framework/tx_context#0x2_tx_context">0x2::tx_context</Link>;
<b>use</b> <Link to="iota_system#0x3_iota_system">0x3::iota_system</Link>;
<b>use</b> <Link to="iota_system_state_inner#0x3_iota_system_state_inner">0x3::iota_system_state_inner</Link>;
<b>use</b> <Link to="timelocked_staking#0x3_timelocked_staking">0x3::timelocked_staking</Link>;
<b>use</b> <Link to="validator#0x3_validator">0x3::validator</Link>;
<b>use</b> <Link to="validator_set#0x3_validator_set">0x3::validator_set</Link>;
</code></pre>



<Link id="0x3_genesis_GenesisValidatorMetadata"></Link>

## Struct `GenesisValidatorMetadata`



<pre><code>
<b>struct</b> <Link to="genesis#0x3_genesis_GenesisValidatorMetadata">GenesisValidatorMetadata</Link> <b>has</b> <b>copy</b>, drop
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
name: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
description: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
image_url: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
project_url: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
iota_address: <b>address</b></code>
</dt>
<dd>

</dd>
<dt>
<code>
gas_price: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
commission_rate: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
protocol_public_key: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
proof_of_possession: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
network_public_key: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
worker_public_key: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
network_address: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
p2p_address: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
primary_address: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
worker_address: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;u8&gt;</code>
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="0x3_genesis_GenesisChainParameters"></Link>

## Struct `GenesisChainParameters`



<pre><code>
<b>struct</b> <Link to="genesis#0x3_genesis_GenesisChainParameters">GenesisChainParameters</Link> <b>has</b> <b>copy</b>, drop
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
protocol_version: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
chain_start_timestamp_ms: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
epoch_duration_ms: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
max_validator_count: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
min_validator_joining_stake: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
validator_low_stake_threshold: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
validator_very_low_stake_threshold: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
validator_low_stake_grace_period: u64</code>
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="0x3_genesis_TokenDistributionSchedule"></Link>

## Struct `TokenDistributionSchedule`



<pre><code>
<b>struct</b> <Link to="genesis#0x3_genesis_TokenDistributionSchedule">TokenDistributionSchedule</Link>
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
pre_minted_supply: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
allocations: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="genesis#0x3_genesis_TokenAllocation">genesis::TokenAllocation</Link>&gt;</code>
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="0x3_genesis_TokenAllocation"></Link>

## Struct `TokenAllocation`



<pre><code>
<b>struct</b> <Link to="genesis#0x3_genesis_TokenAllocation">TokenAllocation</Link>
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
recipient_address: <b>address</b></code>
</dt>
<dd>

</dd>
<dt>
<code>
amount_nanos: u64</code>
</dt>
<dd>

</dd>
<dt>
<code>
staked_with_validator: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<b>address</b>&gt;</code>
</dt>
<dd>
 Indicates if this allocation should be staked at genesis and with which validator
</dd>
<dt>
<code>
staked_with_timelock_expiration: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;</code>
</dt>
<dd>
 Indicates if this allocation should be staked with timelock at genesis
 and contains its timelock_expiration
</dd>
</dl>


</details>

<Link id="@Constants_0"></Link>

## Constants


<Link id="0x3_genesis_ENotCalledAtGenesis"></Link>

The <code>
create</code> function was called at a non-genesis epoch.


<pre><code>
<b>const</b> <Link to="genesis#0x3_genesis_ENotCalledAtGenesis">ENotCalledAtGenesis</Link>: u64 = 0;
</code></pre>



<Link id="0x3_genesis_EDuplicateValidator"></Link>

The <code>
create</code> function was called with duplicate validators.


<pre><code>
<b>const</b> <Link to="genesis#0x3_genesis_EDuplicateValidator">EDuplicateValidator</Link>: u64 = 1;
</code></pre>



<Link id="0x3_genesis_EWrongPreMintedSupply"></Link>

The <code>
create</code> function was called with wrong pre-minted supply.


<pre><code>
<b>const</b> <Link to="genesis#0x3_genesis_EWrongPreMintedSupply">EWrongPreMintedSupply</Link>: u64 = 2;
</code></pre>



<Link id="0x3_genesis_create"></Link>

## Function `create`

This function will be explicitly called once at genesis.
It will create a singleton IotaSystemState object, which contains
all the information we need in the system.


<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_create">create</Link>(iota_system_state_id: <Link to="../iota-framework/object#0x2_object_UID">object::UID</Link>, iota_treasury_cap: <Link to="../iota-framework/iota#0x2_iota_IotaTreasuryCap">iota::IotaTreasuryCap</Link>, genesis_chain_parameters: <Link to="genesis#0x3_genesis_GenesisChainParameters">genesis::GenesisChainParameters</Link>, genesis_validators: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="genesis#0x3_genesis_GenesisValidatorMetadata">genesis::GenesisValidatorMetadata</Link>&gt;, token_distribution_schedule: <Link to="genesis#0x3_genesis_TokenDistributionSchedule">genesis::TokenDistributionSchedule</Link>, timelock_genesis_label: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;, system_timelock_cap: <Link to="../iota-framework/timelock#0x2_timelock_SystemTimelockCap">timelock::SystemTimelockCap</Link>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_create">create</Link>(
    iota_system_state_id: UID,
    <b>mut</b> iota_treasury_cap: IotaTreasuryCap,
    genesis_chain_parameters: <Link to="genesis#0x3_genesis_GenesisChainParameters">GenesisChainParameters</Link>,
    genesis_validators: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="genesis#0x3_genesis_GenesisValidatorMetadata">GenesisValidatorMetadata</Link>&gt;,
    token_distribution_schedule: <Link to="genesis#0x3_genesis_TokenDistributionSchedule">TokenDistributionSchedule</Link>,
    timelock_genesis_label: Option&lt;String&gt;,
    system_timelock_cap: SystemTimelockCap,
    ctx: &<b>mut</b> TxContext,
) \{
    // Ensure this is only called at <Link to="genesis#0x3_genesis">genesis</Link>
    <b>assert</b>!(ctx.epoch() == 0, <Link to="genesis#0x3_genesis_ENotCalledAtGenesis">ENotCalledAtGenesis</Link>);

    <b>let</b> <Link to="genesis#0x3_genesis_TokenDistributionSchedule">TokenDistributionSchedule</Link> \{
        pre_minted_supply,
        allocations,
    } = token_distribution_schedule;

    <b>assert</b>!(iota_treasury_cap.total_supply() == pre_minted_supply, <Link to="genesis#0x3_genesis_EWrongPreMintedSupply">EWrongPreMintedSupply</Link>);

    <b>let</b> <Link to="storage_fund#0x3_storage_fund">storage_fund</Link> = <Link to="../iota-framework/balance#0x2_balance_zero">balance::zero</Link>();

    // Create all the `Validator` structs
    <b>let</b> <b>mut</b> validators = <Link to="../move-stdlib/vector#0x1_vector">vector</Link>[];
    <b>let</b> count = genesis_validators.length();
    <b>let</b> <b>mut</b> i = 0;
    <b>while</b> (i &lt; count) \{
        <b>let</b> <Link to="genesis#0x3_genesis_GenesisValidatorMetadata">GenesisValidatorMetadata</Link> \{
            name,
            description,
            image_url,
            project_url,
            iota_address,
            gas_price,
            commission_rate,
            protocol_public_key,
            proof_of_possession,
            network_public_key,
            worker_public_key,
            network_address,
            p2p_address,
            primary_address,
            worker_address,
        } = genesis_validators[i];

        <b>let</b> <Link to="validator#0x3_validator">validator</Link> = <Link to="validator#0x3_validator_new">validator::new</Link>(
            iota_address,
            protocol_public_key,
            network_public_key,
            worker_public_key,
            proof_of_possession,
            name,
            description,
            image_url,
            project_url,
            network_address,
            p2p_address,
            primary_address,
            worker_address,
            gas_price,
            commission_rate,
            ctx
        );

        // Ensure that each <Link to="validator#0x3_validator">validator</Link> is unique
        <b>assert</b>!(
            !<Link to="validator_set#0x3_validator_set_is_duplicate_validator">validator_set::is_duplicate_validator</Link>(&validators, &<Link to="validator#0x3_validator">validator</Link>),
            <Link to="genesis#0x3_genesis_EDuplicateValidator">EDuplicateValidator</Link>,
        );

        validators.push_back(<Link to="validator#0x3_validator">validator</Link>);

        i = i + 1;
    };

    // Allocate tokens and staking operations
    <Link to="genesis#0x3_genesis_allocate_tokens">allocate_tokens</Link>(
        &<b>mut</b> iota_treasury_cap,
        allocations,
        &<b>mut</b> validators,
        timelock_genesis_label,
        ctx
    );

    // Activate all validators
    <Link to="genesis#0x3_genesis_activate_validators">activate_validators</Link>(&<b>mut</b> validators);

    <b>let</b> system_parameters = <Link to="iota_system_state_inner#0x3_iota_system_state_inner_create_system_parameters">iota_system_state_inner::create_system_parameters</Link>(
        genesis_chain_parameters.epoch_duration_ms,

        // Validator committee parameters
        genesis_chain_parameters.max_validator_count,
        genesis_chain_parameters.min_validator_joining_stake,
        genesis_chain_parameters.validator_low_stake_threshold,
        genesis_chain_parameters.validator_very_low_stake_threshold,
        genesis_chain_parameters.validator_low_stake_grace_period,

        ctx,
    );

    <Link to="iota_system#0x3_iota_system_create">iota_system::create</Link>(
        iota_system_state_id,
        iota_treasury_cap,
        validators,
        <Link to="storage_fund#0x3_storage_fund">storage_fund</Link>,
        genesis_chain_parameters.protocol_version,
        genesis_chain_parameters.chain_start_timestamp_ms,
        system_parameters,
        system_timelock_cap,
        ctx,
    );
}
</code></pre>



</details>

<Link id="0x3_genesis_allocate_tokens"></Link>

## Function `allocate_tokens`



<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_allocate_tokens">allocate_tokens</Link>(iota_treasury_cap: &<b>mut</b> <Link to="../iota-framework/iota#0x2_iota_IotaTreasuryCap">iota::IotaTreasuryCap</Link>, allocations: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="genesis#0x3_genesis_TokenAllocation">genesis::TokenAllocation</Link>&gt;, validators: &<b>mut</b> <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="validator#0x3_validator_Validator">validator::Validator</Link>&gt;, timelock_genesis_label: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_allocate_tokens">allocate_tokens</Link>(
    iota_treasury_cap: &<b>mut</b> IotaTreasuryCap,
    <b>mut</b> allocations: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="genesis#0x3_genesis_TokenAllocation">TokenAllocation</Link>&gt;,
    validators: &<b>mut</b> <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;Validator&gt;,
    timelock_genesis_label: Option&lt;String&gt;,
    ctx: &<b>mut</b> TxContext,
) \{

    <b>while</b> (!allocations.is_empty()) \{
        <b>let</b> <Link to="genesis#0x3_genesis_TokenAllocation">TokenAllocation</Link> \{
            recipient_address,
            amount_nanos,
            staked_with_validator,
            staked_with_timelock_expiration,
        } = allocations.pop_back();

        <b>let</b> allocation_balance = iota_treasury_cap.mint_balance(amount_nanos, ctx);

        <b>if</b> (staked_with_validator.is_some()) \{
            <b>let</b> validator_address = staked_with_validator.destroy_some();
            <b>let</b> <Link to="validator#0x3_validator">validator</Link> = <Link to="validator_set#0x3_validator_set_get_validator_mut">validator_set::get_validator_mut</Link>(
                validators, validator_address
            );
            <b>if</b> (staked_with_timelock_expiration.is_some()) \{
                <b>let</b> timelock_expiration = staked_with_timelock_expiration.destroy_some();
                <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_at_genesis">timelocked_staking::request_add_stake_at_genesis</Link>(
                    <Link to="validator#0x3_validator">validator</Link>,
                    allocation_balance,
                    recipient_address,
                    timelock_expiration,
                    timelock_genesis_label,
                    ctx
                );
            } <b>else</b> \{
                <Link to="validator#0x3_validator">validator</Link>.request_add_stake_at_genesis(
                    allocation_balance,
                    recipient_address,
                    ctx
                );
            }
        } <b>else</b> \{
            <Link to="../iota-framework/iota#0x2_iota_transfer">iota::transfer</Link>(
                allocation_balance.into_coin(ctx),
                recipient_address,
            );
        };
    };
    allocations.destroy_empty();
}
</code></pre>



</details>

<Link id="0x3_genesis_activate_validators"></Link>

## Function `activate_validators`



<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_activate_validators">activate_validators</Link>(validators: &<b>mut</b> <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="validator#0x3_validator_Validator">validator::Validator</Link>&gt;)
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>fun</b> <Link to="genesis#0x3_genesis_activate_validators">activate_validators</Link>(validators: &<b>mut</b> <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;Validator&gt;) \{
    // Activate all <Link to="genesis#0x3_genesis">genesis</Link> validators
    <b>let</b> count = validators.length();
    <b>let</b> <b>mut</b> i = 0;
    <b>while</b> (i &lt; count) \{
        <b>let</b> <Link to="validator#0x3_validator">validator</Link> = &<b>mut</b> validators[i];
        <Link to="validator#0x3_validator">validator</Link>.activate(0);

        i = i + 1;
    };

}
</code></pre>



</details>
