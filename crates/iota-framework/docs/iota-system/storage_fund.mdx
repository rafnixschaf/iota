---
title: Module `0x3::storage_fund`
---
import Link from '@docusaurus/Link';

<Link id="0x3_storage_fund"/>


-  [Struct `StorageFund`](#0x3_storage_fund_StorageFund)
-  [Function `new`](#0x3_storage_fund_new)
-  [Function `advance_epoch`](#0x3_storage_fund_advance_epoch)
-  [Function `total_object_storage_rebates`](#0x3_storage_fund_total_object_storage_rebates)
-  [Function `total_balance`](#0x3_storage_fund_total_balance)


<pre><code>
<b>use</b> <Link to="../iota-framework/balance#0x2_balance">0x2::balance</Link>;
<b>use</b> <Link to="../iota-framework/iota#0x2_iota">0x2::iota</Link>;
</code></pre>



<Link id="0x3_storage_fund_StorageFund"></Link>

## Struct `StorageFund`

Struct representing the storage fund, containing two <code>
Balance</code>s:
- <code>
total_object_storage_rebates</code> has the invariant that it's the sum of <code>
storage_rebate</code> of
all objects currently stored on-chain. To maintain this invariant, the only inflow of this
balance is storage charges collected from transactions, and the only outflow is storage rebates
of transactions, including both the portion refunded to the transaction senders as well as
the non-refundable portion taken out and put into <code>
non_refundable_balance</code>.
- <code>
non_refundable_balance</code> contains any remaining inflow of the storage fund that should not
be taken out of the fund.


<pre><code>
<b>struct</b> <Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link> <b>has</b> store
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
total_object_storage_rebates: <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
non_refundable_balance: <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;</code>
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="0x3_storage_fund_new"></Link>

## Function `new`

Called by <code>
<Link to="iota_system#0x3_iota_system">iota_system</Link></code> at genesis time.


<pre><code>
<b>public</b>(<b>friend</b>) <b>fun</b> <Link to="storage_fund#0x3_storage_fund_new">new</Link>(initial_fund: <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;): <Link to="storage_fund#0x3_storage_fund_StorageFund">storage_fund::StorageFund</Link>
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b>(package) <b>fun</b> <Link to="storage_fund#0x3_storage_fund_new">new</Link>(initial_fund: Balance&lt;IOTA&gt;) : <Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link> \{
    <Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link> \{
        // At the beginning there's no <Link to="../iota-framework/object#0x2_object">object</Link> in the storage yet
        total_object_storage_rebates: <Link to="../iota-framework/balance#0x2_balance_zero">balance::zero</Link>(),
        non_refundable_balance: initial_fund,
    }
}
</code></pre>



</details>

<Link id="0x3_storage_fund_advance_epoch"></Link>

## Function `advance_epoch`

Called by <code>
<Link to="iota_system#0x3_iota_system">iota_system</Link></code> at epoch change times to process the inflows and outflows of storage fund.


<pre><code>
<b>public</b>(<b>friend</b>) <b>fun</b> <Link to="storage_fund#0x3_storage_fund_advance_epoch">advance_epoch</Link>(self: &<b>mut</b> <Link to="storage_fund#0x3_storage_fund_StorageFund">storage_fund::StorageFund</Link>, storage_charges: <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;, storage_rebate_amount: u64, non_refundable_storage_fee_amount: u64): <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b>(package) <b>fun</b> <Link to="storage_fund#0x3_storage_fund_advance_epoch">advance_epoch</Link>(
    self: &<b>mut</b> <Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link>,
    storage_charges: Balance&lt;IOTA&gt;,
    storage_rebate_amount: u64,
    non_refundable_storage_fee_amount: u64,
) : Balance&lt;IOTA&gt; \{
    // The storage charges for the epoch come from the storage rebate of the new objects created
    // and the new storage rebates of the objects modified during the epoch so we put the charges
    // into `total_object_storage_rebates`.
    self.total_object_storage_rebates.join(storage_charges);

    // Split out the non-refundable portion of the storage rebate and put it into the non-refundable <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> non_refundable_storage_fee = self.total_object_storage_rebates.split(non_refundable_storage_fee_amount);
    self.non_refundable_balance.join(non_refundable_storage_fee);

    // `storage_rebates` <b>include</b> the already refunded rebates of deleted objects and <b>old</b> rebates of modified objects and
    // should be taken out of the `total_object_storage_rebates`.
    <b>let</b> storage_rebate = self.total_object_storage_rebates.split(storage_rebate_amount);

    // The storage rebate <b>has</b> already been returned <b>to</b> individual transaction senders' gas coins
    // so we <b>return</b> the <Link to="../iota-framework/balance#0x2_balance">balance</Link> <b>to</b> be burnt at the very end of epoch change.
    storage_rebate
}
</code></pre>



</details>

<Link id="0x3_storage_fund_total_object_storage_rebates"></Link>

## Function `total_object_storage_rebates`



<pre><code>
<b>public</b> <b>fun</b> <Link to="storage_fund#0x3_storage_fund_total_object_storage_rebates">total_object_storage_rebates</Link>(self: &<Link to="storage_fund#0x3_storage_fund_StorageFund">storage_fund::StorageFund</Link>): u64
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="storage_fund#0x3_storage_fund_total_object_storage_rebates">total_object_storage_rebates</Link>(self: &<Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link>): u64 \{
    self.total_object_storage_rebates.value()
}
</code></pre>



</details>

<Link id="0x3_storage_fund_total_balance"></Link>

## Function `total_balance`



<pre><code>
<b>public</b> <b>fun</b> <Link to="storage_fund#0x3_storage_fund_total_balance">total_balance</Link>(self: &<Link to="storage_fund#0x3_storage_fund_StorageFund">storage_fund::StorageFund</Link>): u64
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="storage_fund#0x3_storage_fund_total_balance">total_balance</Link>(self: &<Link to="storage_fund#0x3_storage_fund_StorageFund">StorageFund</Link>): u64 \{
    self.total_object_storage_rebates.value() + self.non_refundable_balance.value()
}
</code></pre>



</details>
