---
title: Module `0xdee9::order_query`
---
import Link from '@docusaurus/Link';

<Link id="0xdee9_order_query"/>


-  [Struct `OrderPage`](#0xdee9_order_query_OrderPage)
-  [Constants](#@Constants_0)
-  [Function `iter_bids`](#0xdee9_order_query_iter_bids)
-  [Function `iter_asks`](#0xdee9_order_query_iter_asks)
-  [Function `iter_ticks_internal`](#0xdee9_order_query_iter_ticks_internal)
-  [Function `orders`](#0xdee9_order_query_orders)
-  [Function `has_next_page`](#0xdee9_order_query_has_next_page)
-  [Function `next_tick_level`](#0xdee9_order_query_next_tick_level)
-  [Function `next_order_id`](#0xdee9_order_query_next_order_id)
-  [Function `order_id`](#0xdee9_order_query_order_id)
-  [Function `tick_level`](#0xdee9_order_query_tick_level)


<pre><code>
<b>use</b> <Link to="../move-stdlib/option#0x1_option">0x1::option</Link>;
<b>use</b> <Link to="../iota-framework/linked_table#0x2_linked_table">0x2::linked_table</Link>;
<b>use</b> <Link to="clob_v2#0xdee9_clob_v2">0xdee9::clob_v2</Link>;
<b>use</b> <Link to="critbit#0xdee9_critbit">0xdee9::critbit</Link>;
</code></pre>



<Link id="0xdee9_order_query_OrderPage"></Link>

## Struct `OrderPage`



<pre><code>
<b>struct</b> <Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link> <b>has</b> drop
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>
orders: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="clob_v2#0xdee9_clob_v2_Order">clob_v2::Order</Link>&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
has_next_page: bool</code>
</dt>
<dd>

</dd>
<dt>
<code>
next_tick_level: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;</code>
</dt>
<dd>

</dd>
<dt>
<code>
next_order_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;</code>
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="@Constants_0"></Link>

## Constants


<Link id="0xdee9_order_query_PAGE_LIMIT"></Link>



<pre><code>
<b>const</b> <Link to="order_query#0xdee9_order_query_PAGE_LIMIT">PAGE_LIMIT</Link>: u64 = 100;
</code></pre>



<Link id="0xdee9_order_query_iter_bids"></Link>

## Function `iter_bids`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_iter_bids">iter_bids</Link>&lt;T1, T2&gt;(pool: &<Link to="clob_v2#0xdee9_clob_v2_Pool">clob_v2::Pool</Link>&lt;T1, T2&gt;, start_tick_level: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, start_order_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, min_expire_timestamp: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, max_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, ascending: bool): <Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_iter_bids">iter_bids</Link>&lt;T1, T2&gt;(
    pool: &Pool&lt;T1, T2&gt;,
    // tick level <b>to</b> start from
    start_tick_level: Option&lt;u64&gt;,
    // order id within that tick level <b>to</b> start from
    start_order_id: Option&lt;u64&gt;,
    // <b>if</b> provided, do not <b>include</b> orders <b>with</b> an expire timestamp less than the provided value (expired order),
    // value is in microseconds
    min_expire_timestamp: Option&lt;u64&gt;,
    // do not show orders <b>with</b> an ID larger than max_id--
    // i.e., orders added later than this one
    max_id: Option&lt;u64&gt;,
    // <b>if</b> <b>true</b>, the orders are returned in ascending tick level.
    ascending: bool,
): <Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link> \{
    <b>let</b> bids = <Link to="clob_v2#0xdee9_clob_v2_bids">clob_v2::bids</Link>(pool);
    <b>let</b> <b>mut</b> orders = <Link to="order_query#0xdee9_order_query_iter_ticks_internal">iter_ticks_internal</Link>(
        bids,
        start_tick_level,
        start_order_id,
        min_expire_timestamp,
        max_id,
        ascending
    );
    <b>let</b> (orders, has_next_page, next_tick_level, next_order_id) = <b>if</b> (<Link to="../move-stdlib/vector#0x1_vector_length">vector::length</Link>(&orders) &gt; <Link to="order_query#0xdee9_order_query_PAGE_LIMIT">PAGE_LIMIT</Link>) \{
        <b>let</b> last_order = <Link to="../move-stdlib/vector#0x1_vector_pop_back">vector::pop_back</Link>(&<b>mut</b> orders);
        (orders, <b>true</b>, some(<Link to="clob_v2#0xdee9_clob_v2_tick_level">clob_v2::tick_level</Link>(&last_order)), some(<Link to="clob_v2#0xdee9_clob_v2_order_id">clob_v2::order_id</Link>(&last_order)))
    } <b>else</b> \{
        (orders, <b>false</b>, none(), none())
    };

    <Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link> \{
        orders,
        has_next_page,
        next_tick_level,
        next_order_id
    }
}
</code></pre>



</details>

<Link id="0xdee9_order_query_iter_asks"></Link>

## Function `iter_asks`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_iter_asks">iter_asks</Link>&lt;T1, T2&gt;(pool: &<Link to="clob_v2#0xdee9_clob_v2_Pool">clob_v2::Pool</Link>&lt;T1, T2&gt;, start_tick_level: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, start_order_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, min_expire_timestamp: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, max_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, ascending: bool): <Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_iter_asks">iter_asks</Link>&lt;T1, T2&gt;(
    pool: &Pool&lt;T1, T2&gt;,
    // tick level <b>to</b> start from
    start_tick_level: Option&lt;u64&gt;,
    // order id within that tick level <b>to</b> start from
    start_order_id: Option&lt;u64&gt;,
    // <b>if</b> provided, do not <b>include</b> orders <b>with</b> an expire timestamp less than the provided value (expired order),
    // value is in microseconds
    min_expire_timestamp: Option&lt;u64&gt;,
    // do not show orders <b>with</b> an ID larger than max_id--
    // i.e., orders added later than this one
    max_id: Option&lt;u64&gt;,
    // <b>if</b> <b>true</b>, the orders are returned in ascending tick level.
    ascending: bool,
): <Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link> \{
    <b>let</b> asks = <Link to="clob_v2#0xdee9_clob_v2_asks">clob_v2::asks</Link>(pool);
    <b>let</b> <b>mut</b> orders = <Link to="order_query#0xdee9_order_query_iter_ticks_internal">iter_ticks_internal</Link>(
        asks,
        start_tick_level,
        start_order_id,
        min_expire_timestamp,
        max_id,
        ascending
    );
    <b>let</b> (orders, has_next_page, next_tick_level, next_order_id) = <b>if</b> (<Link to="../move-stdlib/vector#0x1_vector_length">vector::length</Link>(&orders) &gt; <Link to="order_query#0xdee9_order_query_PAGE_LIMIT">PAGE_LIMIT</Link>) \{
        <b>let</b> last_order = <Link to="../move-stdlib/vector#0x1_vector_pop_back">vector::pop_back</Link>(&<b>mut</b> orders);
        (orders, <b>true</b>, some(<Link to="clob_v2#0xdee9_clob_v2_tick_level">clob_v2::tick_level</Link>(&last_order)), some(<Link to="clob_v2#0xdee9_clob_v2_order_id">clob_v2::order_id</Link>(&last_order)))
    } <b>else</b> \{
        (orders, <b>false</b>, none(), none())
    };

    <Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link> \{
        orders,
        has_next_page,
        next_tick_level,
        next_order_id
    }
}
</code></pre>



</details>

<Link id="0xdee9_order_query_iter_ticks_internal"></Link>

## Function `iter_ticks_internal`



<pre><code>
<b>fun</b> <Link to="order_query#0xdee9_order_query_iter_ticks_internal">iter_ticks_internal</Link>(ticks: &<Link to="critbit#0xdee9_critbit_CritbitTree">critbit::CritbitTree</Link>&lt;<Link to="clob_v2#0xdee9_clob_v2_TickLevel">clob_v2::TickLevel</Link>&gt;, start_tick_level: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, start_order_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, min_expire_timestamp: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, max_id: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;, ascending: bool): <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="clob_v2#0xdee9_clob_v2_Order">clob_v2::Order</Link>&gt;
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>fun</b> <Link to="order_query#0xdee9_order_query_iter_ticks_internal">iter_ticks_internal</Link>(
    ticks: &CritbitTree&lt;TickLevel&gt;,
    // tick level <b>to</b> start from
    start_tick_level: Option&lt;u64&gt;,
    // order id within that tick level <b>to</b> start from
    <b>mut</b> start_order_id: Option&lt;u64&gt;,
    // <b>if</b> provided, do not <b>include</b> orders <b>with</b> an expire timestamp less than the provided value (expired order),
    // value is in microseconds
    min_expire_timestamp: Option&lt;u64&gt;,
    // do not show orders <b>with</b> an ID larger than max_id--
    // i.e., orders added later than this one
    max_id: Option&lt;u64&gt;,
    // <b>if</b> <b>true</b>, the orders are returned in ascending tick level.
    ascending: bool,
): <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;Order&gt; \{
    <b>let</b> <b>mut</b> tick_level_key = <b>if</b> (<Link to="../move-stdlib/option#0x1_option_is_some">option::is_some</Link>(&start_tick_level)) \{
        <Link to="../move-stdlib/option#0x1_option_destroy_some">option::destroy_some</Link>(start_tick_level)
    } <b>else</b> \{
        <b>let</b> (key, _) = <b>if</b> (ascending) \{
            <Link to="critbit#0xdee9_critbit_min_leaf">critbit::min_leaf</Link>(ticks)
        }<b>else</b> \{
            <Link to="critbit#0xdee9_critbit_max_leaf">critbit::max_leaf</Link>(ticks)
        };
        key
    };

    <b>let</b> <b>mut</b> orders = <Link to="../move-stdlib/vector#0x1_vector">vector</Link>[];

    <b>while</b> (tick_level_key != 0 && <Link to="../move-stdlib/vector#0x1_vector_length">vector::length</Link>(&orders) &lt; <Link to="order_query#0xdee9_order_query_PAGE_LIMIT">PAGE_LIMIT</Link> + 1) \{
        <b>let</b> tick_level = <Link to="critbit#0xdee9_critbit_borrow_leaf_by_key">critbit::borrow_leaf_by_key</Link>(ticks, tick_level_key);
        <b>let</b> open_orders = <Link to="clob_v2#0xdee9_clob_v2_open_orders">clob_v2::open_orders</Link>(tick_level);

        <b>let</b> <b>mut</b> next_order_key = <b>if</b> (<Link to="../move-stdlib/option#0x1_option_is_some">option::is_some</Link>(&start_order_id)) \{
            <b>let</b> key = <Link to="../move-stdlib/option#0x1_option_destroy_some">option::destroy_some</Link>(start_order_id);
            <b>if</b> (!<Link to="../iota-framework/linked_table#0x2_linked_table_contains">linked_table::contains</Link>(open_orders, key)) \{
                <b>let</b> (next_leaf, _) = <b>if</b> (ascending) \{
                    <Link to="critbit#0xdee9_critbit_next_leaf">critbit::next_leaf</Link>(ticks, tick_level_key)
                }<b>else</b> \{
                    <Link to="critbit#0xdee9_critbit_previous_leaf">critbit::previous_leaf</Link>(ticks, tick_level_key)
                };
                tick_level_key = next_leaf;
                <b>continue</b>
            };
            start_order_id = <Link to="../move-stdlib/option#0x1_option_none">option::none</Link>();
            some(key)
        }<b>else</b> \{
            *<Link to="../iota-framework/linked_table#0x2_linked_table_front">linked_table::front</Link>(open_orders)
        };

        <b>while</b> (<Link to="../move-stdlib/option#0x1_option_is_some">option::is_some</Link>(&next_order_key) && <Link to="../move-stdlib/vector#0x1_vector_length">vector::length</Link>(&orders) &lt; <Link to="order_query#0xdee9_order_query_PAGE_LIMIT">PAGE_LIMIT</Link> + 1) \{
            <b>let</b> key = <Link to="../move-stdlib/option#0x1_option_destroy_some">option::destroy_some</Link>(next_order_key);
            <b>let</b> order = <Link to="../iota-framework/linked_table#0x2_linked_table_borrow">linked_table::borrow</Link>(open_orders, key);

            // <b>if</b> the order id is greater than max_id, we end the iteration for this tick level.
            <b>if</b> (<Link to="../move-stdlib/option#0x1_option_is_some">option::is_some</Link>(&max_id) && key &gt; <Link to="../move-stdlib/option#0x1_option_destroy_some">option::destroy_some</Link>(max_id)) \{
                <b>break</b>
            };

            next_order_key = *<Link to="../iota-framework/linked_table#0x2_linked_table_next">linked_table::next</Link>(open_orders, key);

            // <b>if</b> expire timestamp is set, and <b>if</b> the order is expired, we skip it.
            <b>if</b> (<Link to="../move-stdlib/option#0x1_option_is_none">option::is_none</Link>(&min_expire_timestamp) ||
                <Link to="clob_v2#0xdee9_clob_v2_expire_timestamp">clob_v2::expire_timestamp</Link>(order) &gt; <Link to="../move-stdlib/option#0x1_option_destroy_some">option::destroy_some</Link>(min_expire_timestamp)) \{
                <Link to="../move-stdlib/vector#0x1_vector_push_back">vector::push_back</Link>(&<b>mut</b> orders, <Link to="clob_v2#0xdee9_clob_v2_clone_order">clob_v2::clone_order</Link>(order));
            };
        };
        <b>let</b> (next_leaf, _) = <b>if</b> (ascending) \{
            <Link to="critbit#0xdee9_critbit_next_leaf">critbit::next_leaf</Link>(ticks, tick_level_key)
        }<b>else</b> \{
            <Link to="critbit#0xdee9_critbit_previous_leaf">critbit::previous_leaf</Link>(ticks, tick_level_key)
        };
        tick_level_key = next_leaf;
    };
    orders
}
</code></pre>



</details>

<Link id="0xdee9_order_query_orders"></Link>

## Function `orders`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_orders">orders</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>): &<Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="clob_v2#0xdee9_clob_v2_Order">clob_v2::Order</Link>&gt;
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_orders">orders</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link>): &<Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;Order&gt; \{
    &page.orders
}
</code></pre>



</details>

<Link id="0xdee9_order_query_has_next_page"></Link>

## Function `has_next_page`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_has_next_page">has_next_page</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>): bool
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_has_next_page">has_next_page</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link>): bool \{
    page.has_next_page
}
</code></pre>



</details>

<Link id="0xdee9_order_query_next_tick_level"></Link>

## Function `next_tick_level`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_next_tick_level">next_tick_level</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>): <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_next_tick_level">next_tick_level</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link>): Option&lt;u64&gt; \{
    page.next_tick_level
}
</code></pre>



</details>

<Link id="0xdee9_order_query_next_order_id"></Link>

## Function `next_order_id`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_next_order_id">next_order_id</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">order_query::OrderPage</Link>): <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;u64&gt;
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_next_order_id">next_order_id</Link>(page: &<Link to="order_query#0xdee9_order_query_OrderPage">OrderPage</Link>): Option&lt;u64&gt; \{
    page.next_order_id
}
</code></pre>



</details>

<Link id="0xdee9_order_query_order_id"></Link>

## Function `order_id`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_order_id">order_id</Link>(order: &<Link to="clob_v2#0xdee9_clob_v2_Order">clob_v2::Order</Link>): u64
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_order_id">order_id</Link>(order: &Order): u64 \{
    <Link to="clob_v2#0xdee9_clob_v2_order_id">clob_v2::order_id</Link>(order)
}
</code></pre>



</details>

<Link id="0xdee9_order_query_tick_level"></Link>

## Function `tick_level`



<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_tick_level">tick_level</Link>(order: &<Link to="clob_v2#0xdee9_clob_v2_Order">clob_v2::Order</Link>): u64
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="order_query#0xdee9_order_query_tick_level">tick_level</Link>(order: &Order): u64 \{
    <Link to="clob_v2#0xdee9_clob_v2_tick_level">clob_v2::tick_level</Link>(order)
}
</code></pre>



</details>
